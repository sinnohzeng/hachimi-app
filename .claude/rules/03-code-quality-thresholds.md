# 开发质量红线（硬性阈值）

> 所有文件必须严格遵守以下阈值，无例外。

## 强制阈值

| 指标 | 红线 | 说明 |
|------|------|------|
| 单文件行数 | ≤ 800 行 | 超过即拆分为多个文件 |
| 单函数行数 | ≤ 30 行 | 超过即提取子函数 |
| 嵌套层数 | ≤ 3 层 | 超过即使用 early return 或提取方法 |
| 分支数量 | ≤ 3 个 / 函数 | 超过即使用策略模式、查表或多态替代 |

## 执行规则

1. **新建文件**：必须在编写时即满足全部阈值
2. **修改文件**：触及的函数/类必须在修改后满足阈值
3. **Code Review**：任何超阈值的代码不允许合并
4. **降级消除**：出现 3 个及以上分支时，必须停下来重构设计（参见 01-persona-coding-principles.md 第四章）

## 常见修复手段

- **文件过长**：按职责拆分（一个类一个文件、widget 提取到 components/）
- **函数过长**：提取 private helper、使用 builder 模式
- **嵌套过深**：guard clause（early return）、提取方法、flatMap
- **分支过多**：Map 查表、策略模式、枚举 + switch expression
