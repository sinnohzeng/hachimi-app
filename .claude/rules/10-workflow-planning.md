---
trigger: always_on
---

# 项目计划与上下文文档生成

> 本文件整合了项目计划生成系统与上下文文档生成规范。

**重要**：此模式下只生成计划文档，不执行任何代码实现。

---

## 一、工作流程

```
需求收集 → 深入分析 → 生成计划文档 → 完成
```

---

## 二、可视化呈现原则

- **覆盖层级**：每个层级的计划文档都需至少输出一项与其作用匹配的可视化视图，可嵌入 Markdown。
- **多视角**：综合使用流程图、结构图、矩阵表、时间线等形式，分别说明系统逻辑、数据流向、责任归属与节奏安排。
- **抽象占位**：保持抽象描述，使用占位符标记节点/时间点/数据名，避免生成具体实现细节。
- **一致性检查**：图表中的任务编号、名称需与文本保持一致，生成后自查编号和依赖关系是否匹配。
- **系统流程示意**：对于跨服务/数据管线，优先用框线字符（如 `┌─┐`/`└─┘`/`│`/`▼`）绘制 ASCII 流程框图。

---

## 三、需求收集与确认

### 3.1 深入提问（直到用户完全确认）

重点询问以下方面，直到完全理解需求：

1. **项目目标**
   - 核心功能是什么？
   - 要解决什么问题？
   - 期望达到什么效果？

2. **功能模块**
   - 可以分为哪几个主要模块？（至少 2-5 个）
   - 各模块之间的关系？
   - 哪些是核心模块，哪些是辅助模块？

3. **技术栈**
   - 有技术偏好或限制吗？
   - 使用什么编程语言？
   - 使用什么框架或库？

4. **数据流向**
   - 需要处理什么数据？
   - 数据从哪里来？
   - 数据到哪里去？

5. **环境依赖**
   - 需要什么外部服务？（数据库、API、第三方服务等）
   - 有什么环境要求？

6. **验收标准**
   - 如何判断项目完成？
   - 具体的验收指标是什么？

7. **约束条件**
   - 时间限制？
   - 资源限制？
   - 技术限制？

8. **可视化偏好**
   - 希望看到哪些图表类型？
   - 是否有指定的工具/格式（如 Mermaid、表格、思维导图等）？

### 3.2 需求总结与确认

- 将所有信息整理成结构化的需求文档
- 明确列出功能清单
- 说明将生成的计划文件数量
- **等待用户明确回复"确认"或"开始"后才继续**

---

## 四、扁平化计划文档系统

### 4.1 文件结构

```
plan/
├── plan_01_总体计划.md
├── plan_02_[模块名].md       # 2级任务
├── plan_03_[子任务名].md     # 3级任务
├── plan_04_[子任务名].md     # 3级任务
├── plan_05_[模块名].md       # 2级任务
├── plan_06_[子任务名].md     # 3级任务
└── ...（按执行顺序连续编号）
```

### 4.2 命名规范

- **格式**：`plan_XX_任务名.md`
- **编号**：从 01 开始连续递增，不跳号
- **排序原则**：
  - plan_01 必须是"总体计划"（1级）
  - 2级任务（模块）后紧跟其所有3级子任务
  - 按照依赖关系和执行顺序排列

### 4.3 层级关系标记

通过 YAML frontmatter 标记：

```yaml
---
level: 1/2/3              # 层级：1=总计划，2=模块，3=具体任务
file_id: plan_XX          # 文件编号
parent: plan_XX           # 父任务编号（1级无此字段）
children: [plan_XX, ...]  # 子任务编号列表（3级无此字段）
status: pending           # 状态（默认 pending）
created: YYYY-MM-DD HH:mm # 创建时间
estimated_time: XX分钟     # 预估耗时（仅3级任务）
---
```

---

## 五、计划文档模板

### 5.1 1级：总体计划模板

```markdown
---
level: 1
file_id: plan_01
status: pending
created: YYYY-MM-DD HH:mm
children: [plan_02, plan_06, plan_09]
---

# 总体计划：[项目名称]

## 项目概述

### 项目背景
[为什么要做这个项目，要解决什么问题]

### 项目目标
[项目的核心目标和期望达成的效果]

### 项目价值
[项目完成后带来的价值]

---

## 可视化视图

### 系统逻辑图
（使用 Mermaid 或 ASCII 图）

### 模块关系矩阵
| 模块 | 主要输入 | 主要输出 | 责任角色 | 依赖 |
| --- | --- | --- | --- | --- |

### 项目时间线
（使用 Mermaid Gantt 图）

---

## 需求定义

### 功能需求
1. [功能点1的详细描述]
2. [功能点2的详细描述]

### 非功能需求
- **性能要求**：[响应时间、并发量等]
- **安全要求**：[认证、授权、加密等]
- **可用性**：[容错、恢复机制等]

---

## 任务分解树

（树形结构展示）

---

## 技术栈

### 编程语言
### 框架/库
### 数据库
### 工具

---

## 验收标准

### 功能验收
### 性能验收
### 质量验收

---

## 风险评估

### 技术风险
### 资源风险
### 时间风险

---

## 项目统计

- **总计划文件**：XX 个
- **2级任务（模块）**：XX 个
- **3级任务（具体任务）**：XX 个
- **预估总耗时**：XX 小时 XX 分钟
```

### 5.2 2级：模块计划模板

```markdown
---
level: 2
file_id: plan_XX
parent: plan_01
status: pending
created: YYYY-MM-DD HH:mm
children: [plan_XX, plan_XX, plan_XX]
estimated_time: XXX分钟
---

# 模块：[模块名称]

## 模块概述
### 模块目标
### 在项目中的位置

## 依赖关系
### 前置条件
### 后续影响
### 外部依赖

## 子任务分解

## 技术方案
### 架构设计
### 核心技术选型
### 数据模型
### 接口设计

## 执行摘要
### 输入
### 处理
### 输出

## 风险与挑战

## 验收标准

## 交付物清单
```

### 5.3 3级：具体任务计划模板

```markdown
---
level: 3
file_id: plan_XX
parent: plan_XX
status: pending
created: YYYY-MM-DD HH:mm
estimated_time: XX分钟
---

# 任务：[任务名称]

## 任务概述
### 任务描述
### 任务目的

## 依赖关系
### 前置条件
### 对后续的影响

## 执行步骤

### 步骤1：[步骤名称]
- **操作**：[具体做什么]
- **输入**：[需要什么]
- **输出**：[产生什么]
- **注意事项**：[需要注意的点]

## 文件操作清单
### 需要创建的文件
### 需要修改的文件
### 需要读取的文件

## 实现清单
### 功能模块
### 数据结构
### 算法逻辑
### 接口定义

## 测试要求
### 单元测试
### 集成测试
### 手动测试

## 验收标准

## 注意事项
```

---

## 六、上下文文档生成

### 6.1 角色与目标

基于**当前对话中的全部已知信息**，生成一份**完整、结构化、可迁移、可长期维护的项目上下文文档**，用于跨会话复用、项目管理与后续 Prompt 注入。

### 6.2 重要规则

- 若某字段在当前对话中**未明确出现或无法合理推断**，**必须保留该字段**，并统一填写为"暂无信息"
- 不得自行虚构事实，不得省略字段
- 输出内容必须结构稳定、层级清晰、可直接复制使用

### 6.3 上下文文档结构

```markdown
# 项目上下文文档

## 1. 项目概要（Project Overview）
- 项目名称
- 项目背景
- 目标与目的
- 要解决的问题
- 整体愿景

## 2. 范围定义（Scope Definition）
- 当前范围
- 非本次范围
- 约束条件

## 3. 关键实体与关系（Key Entities & Relationships）
- 核心实体
- 实体职责
- 实体关系描述

## 4. 功能模块拆解（Functional Decomposition）
- 模块列表
- 模块详情
- 典型用户场景

## 5. 技术方向与关键决策（Technical Direction & Decisions）
- 客户端
- 服务端
- 模型或算法层
- 数据流与架构
- 已做技术决策
- 可替代方案

## 6. 交互、风格与输出约定（Interaction & Style Conventions）
- AI 输出风格
- 表达规范
- 格式要求
- 用户特殊偏好

## 7. 当前进展总结（Current Status）
- 已确认事实
- 未解决问题

## 8. 后续计划与风险（Next Steps & Risks）
- 待讨论主题
- 潜在风险与不确定性
- 推荐的后续初始化 Prompt
```

---

## 七、适用场景说明

本工作流适用于以下情况：

- 需要制定详细的项目实施计划
- 长对话或复杂项目已积累大量上下文
- 需要"一键导出"当前项目的完整认知状态
- 需要在新会话中无损迁移上下文
- 需要将对话内容工程化、文档化、系统化
